# HOPEåˆ†å±‚çŸ¥è¯†ç®¡ç†ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

**ç³»ç»Ÿåç§°ï¼š** HOPE (Hierarchical Omni-Agent Persistent Engine)  
**ç‰ˆæœ¬ï¼š** 1.0.0  
**æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š** 2025-12-31  
**çŠ¶æ€ï¼š** âœ… å·²å®ç°ï¼ˆä½†ç¼ºå°‘æ–‡æ¡£ï¼‰

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
5. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
6. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
7. [APIå‚è€ƒ](#apiå‚è€ƒ)

---

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

### ä»€ä¹ˆæ˜¯HOPEç³»ç»Ÿï¼Ÿ

HOPE (Hierarchical Omni-Agent Persistent Engine) æ˜¯ OmniAgent çš„**åˆ†å±‚çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ**ï¼Œé€šè¿‡å°†çŸ¥è¯†åˆ†ä¸ºä¸‰ä¸ªå±‚çº§ï¼Œå®ç°æ™ºèƒ½çš„çŸ¥è¯†æ£€ç´¢å’Œé—®ç­”ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦HOPEï¼Ÿ

åœ¨ä¼ ç»Ÿçš„RAGç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰çŸ¥è¯†éƒ½è¢«å¹³ç­‰å¯¹å¾…ï¼Œè¿™å¯¼è‡´ï¼š
- âŒ é¢‘ç¹è®¿é—®çš„çŸ¥è¯†æ£€ç´¢æ•ˆç‡ä½
- âŒ æ ¸å¿ƒçŸ¥è¯†å’Œä¸´æ—¶çŸ¥è¯†æ··åœ¨ä¸€èµ·
- âŒ æ— æ³•æ ¹æ®çŸ¥è¯†çš„é‡è¦æ€§ä¼˜åŒ–æŸ¥è¯¢ç­–ç•¥

HOPEé€šè¿‡**åˆ†å±‚ç®¡ç†**è§£å†³è¿™äº›é—®é¢˜ï¼š
- âœ… é«˜é¢‘çŸ¥è¯†å¿«é€Ÿå“åº”
- âœ… æ ¸å¿ƒçŸ¥è¯†ä¼˜å…ˆçº§é«˜
- âœ… æ™ºèƒ½è·¯ç”±åˆ°åˆé€‚çš„çŸ¥è¯†å±‚

### æ ¸å¿ƒä»·å€¼

1. **æå‡æ£€ç´¢æ•ˆç‡** - æ ¹æ®é—®é¢˜ç±»å‹é€‰æ‹©åˆé€‚çš„çŸ¥è¯†å±‚
2. **ä¼˜åŒ–çŸ¥è¯†ç»„ç»‡** - æŒ‰é‡è¦æ€§å’Œè®¿é—®é¢‘ç‡åˆ†å±‚
3. **æ”¯æŒçŸ¥è¯†æ¼”åŒ–** - æ ¹æ®è®¿é—®æ¨¡å¼åŠ¨æ€è°ƒæ•´å±‚çº§
4. **ç»Ÿè®¡å’Œåˆ†æ** - è·Ÿè¸ªæ¯å±‚çš„ä½¿ç”¨æƒ…å†µ

---

## ğŸ—ï¸ æ ¸å¿ƒæ¦‚å¿µ

### ä¸‰å±‚çŸ¥è¯†ç»“æ„

HOPEç³»ç»Ÿå°†çŸ¥è¯†åˆ†ä¸ºä¸‰ä¸ªå±‚çº§ï¼š

#### 1. Permanent Layer (æŒä¹…å±‚) â­â­â­

**å®šä½ï¼š** é•¿æœŸç¨³å®šçš„æ ¸å¿ƒçŸ¥è¯†

**ç‰¹ç‚¹ï¼š**
- ğŸ“Œ ä¸ç»å¸¸å˜åŒ–
- ğŸ¯ é«˜ä¼˜å…ˆçº§
- ğŸ“š ç³»ç»Ÿçº§çŸ¥è¯†

**é€‚ç”¨åœºæ™¯ï¼š**
- ç³»ç»Ÿé…ç½®å’Œè®¾ç½®
- åŸºç¡€æ¦‚å¿µå’Œå®šä¹‰
- æ ¸å¿ƒä¸šåŠ¡è§„åˆ™
- æ¶æ„è®¾è®¡æ–‡æ¡£

**ç¤ºä¾‹é—®é¢˜ï¼š**
- "å¦‚ä½•é…ç½®RAGç³»ç»Ÿï¼Ÿ"
- "ä»€ä¹ˆæ˜¯çŸ¥è¯†åŸŸï¼Ÿ"
- "ç³»ç»Ÿæ”¯æŒå“ªäº›æ–‡æ¡£æ ¼å¼ï¼Ÿ"

#### 2. Ordinary Layer (æ™®é€šå±‚) â­â­

**å®šä½ï¼š** ä¸€èˆ¬æ€§çŸ¥è¯†

**ç‰¹ç‚¹ï¼š**
- ğŸ“– ä¸­ç­‰ä¼˜å…ˆçº§
- ğŸ”„ å¯èƒ½å˜åŒ–
- ğŸ’¼ ä¸šåŠ¡çŸ¥è¯†

**é€‚ç”¨åœºæ™¯ï¼š**
- ä¸šåŠ¡æµç¨‹
- é¢†åŸŸçŸ¥è¯†
- é¡¹ç›®æ–‡æ¡£
- ç”¨æˆ·æ‰‹å†Œ

**ç¤ºä¾‹é—®é¢˜ï¼š**
- "å¦‚ä½•å¤„ç†PDFæ–‡æ¡£ï¼Ÿ"
- "æ–‡æ¡£åˆ†å—çš„ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ"
- "RAGç´¢å¼•å¦‚ä½•æ„å»ºï¼Ÿ"

#### 3. High Frequency Layer (é«˜é¢‘å±‚) â­

**å®šä½ï¼š** é¢‘ç¹è®¿é—®çš„çŸ¥è¯†

**ç‰¹ç‚¹ï¼š**
- âš¡ å¿«é€Ÿå“åº”
- ğŸ”¥ çƒ­ç‚¹é—®é¢˜
- ğŸ“Š åŸºäºç»Ÿè®¡

**é€‚ç”¨åœºæ™¯ï¼š**
- å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰
- çƒ­ç‚¹è¯é¢˜
- è¿‘æœŸæ´»è·ƒçš„çŸ¥è¯†
- ç”¨æˆ·åé¦ˆå¤šçš„å†…å®¹

**ç¤ºä¾‹é—®é¢˜ï¼š**
- "å¦‚ä½•å¿«é€Ÿä¸Šæ‰‹ï¼Ÿ"
- "å¸¸è§é”™è¯¯æœ‰å“ªäº›ï¼Ÿ"
- "æœ€æ–°åŠŸèƒ½ä»‹ç»"

### çŸ¥è¯†æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·é—®é¢˜                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QuestionClassifier (é—®é¢˜åˆ†ç±»å™¨)                      â”‚
â”‚  - åŸºäºå…³é”®è¯                                         â”‚
â”‚  - åŸºäºæ­£åˆ™è¡¨è¾¾å¼                                      â”‚
â”‚  - åŸºäºè‡ªå®šä¹‰è§„åˆ™                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“               â†“               â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚æŒä¹…å±‚     â”‚   â”‚æ™®é€šå±‚     â”‚   â”‚é«˜é¢‘å±‚     â”‚
  â”‚Permanent â”‚   â”‚Ordinary  â”‚   â”‚High Freq â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“               â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RAG Service (è¯­ä¹‰æœç´¢)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŸ¥è¯¢ç»“æœ + ç½®ä¿¡åº¦                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨å±‚ (Application Layer)                          â”‚
â”‚  - Web API                                          â”‚
â”‚  - Service                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HOPEæ ¸å¿ƒå±‚ (HOPE Core Layer)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  HOPEKnowledgeManager                       â”‚   â”‚
â”‚  â”‚  - æŸ¥è¯¢åè°ƒ                                   â”‚   â”‚
â”‚  â”‚  - ç»Ÿè®¡åˆ†æ                                   â”‚   â”‚
â”‚  â”‚  - å±‚çº§ç®¡ç†                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  QuestionClassifier                         â”‚   â”‚
â”‚  â”‚  - é—®é¢˜åˆ†ç±»                                   â”‚   â”‚
â”‚  â”‚  - è§„åˆ™åŒ¹é…                                   â”‚   â”‚
â”‚  â”‚  - å±‚çº§å»ºè®®                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŒä¹…åŒ–å±‚ (Persistence Layer)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  HopePersistence (æ¥å£)                     â”‚   â”‚
â”‚  â”‚  - InMemoryHopePersistence (å†…å­˜å®ç°)       â”‚   â”‚
â”‚  â”‚  - KnowledgeRegistryHopePersistence (ç”Ÿäº§)  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RAGæœåŠ¡å±‚ (RAG Service Layer)                       â”‚
â”‚  - è¯­ä¹‰æœç´¢                                          â”‚
â”‚  - å‘é‡æ£€ç´¢                                          â”‚
â”‚  - æ–‡æ¡£ç´¢å¼•                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—ç»„æˆ

| æ¨¡å— | åŒ…è·¯å¾„ | èŒè´£ |
|------|--------|------|
| HOPEKnowledgeManager | top.yumbo.ai.omni.core.hope | æ ¸å¿ƒåè°ƒå™¨ |
| QuestionClassifier | top.yumbo.ai.omni.core.hope | é—®é¢˜åˆ†ç±»å™¨ |
| HopePersistence | top.yumbo.ai.omni.core.hope.persistence | æŒä¹…åŒ–æ¥å£ |
| InMemoryHopePersistence | ...persistence.impl | å†…å­˜å®ç° |
| KnowledgeRegistryHopePersistence | ...persistence.impl | çŸ¥è¯†æ³¨å†Œè¡¨å®ç° |
| HopePersistenceAutoConfiguration | ...hope.config | è‡ªåŠ¨é…ç½® |

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. HOPEKnowledgeManager

**èŒè´£ï¼š** HOPEç³»ç»Ÿçš„æ ¸å¿ƒåè°ƒå™¨

#### ä¸»è¦æ–¹æ³•

```java
@Service
public class HOPEKnowledgeManager {
    
    /**
     * æŸ¥è¯¢çŸ¥è¯†
     * 
     * @param question ç”¨æˆ·é—®é¢˜
     * @param maxResults æœ€å¤§ç»“æœæ•°
     * @return æŸ¥è¯¢ç»“æœ
     */
    public QueryResult query(String question, int maxResults);
    
    /**
     * æ™ºèƒ½æŸ¥è¯¢ï¼ˆå¢å¼ºç‰ˆï¼Œæ”¯æŒä¸Šä¸‹æ–‡ï¼‰
     * 
     * @param question ç”¨æˆ·é—®é¢˜
     * @param context ä¸Šä¸‹æ–‡ä¿¡æ¯
     * @return æŸ¥è¯¢ç»“æœ
     */
    public QueryResult smartQuery(String question, String context);
    
    /**
     * è·å–å±‚çº§ç»Ÿè®¡ä¿¡æ¯
     */
    public Map<String, LayerStats> getLayerStats();
    
    /**
     * é‡ç½®ç»Ÿè®¡ä¿¡æ¯
     */
    public void resetStats();
}
```

#### æŸ¥è¯¢æµç¨‹

```java
public QueryResult query(String question, int maxResults) {
    // 1. åˆ†ç±»é—®é¢˜
    String questionType = questionClassifier.classify(question);
    String suggestedLayer = questionClassifier.getSuggestedLayer(questionType);
    
    // 2. ä½¿ç”¨ RAG è¿›è¡Œè¯­ä¹‰æœç´¢
    List<Document> documents = ragService.semanticSearch(question, maxResults);
    
    // 3. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    updateStats(suggestedLayer);
    
    // 4. æ„å»ºç»“æœï¼ˆåŒ…å«ç½®ä¿¡åº¦è®¡ç®—ï¼‰
    return buildResult(question, questionType, suggestedLayer, documents);
}
```

#### QueryResult æ¨¡å‹

```java
public static class QueryResult {
    private String question;             // ç”¨æˆ·é—®é¢˜
    private String questionType;         // é—®é¢˜ç±»å‹
    private String suggestedLayer;       // å»ºè®®çš„å±‚çº§
    private List<Document> documents;    // æ£€ç´¢åˆ°çš„æ–‡æ¡£
    private Long queryTimeMs;            // æŸ¥è¯¢è€—æ—¶
    private Boolean success;             // æ˜¯å¦æˆåŠŸ
    private Double confidence;           // ç½®ä¿¡åº¦
    private String answer;               // å­¦ä¹ ç³»ç»Ÿçš„ç­”æ¡ˆï¼ˆå¯é€‰ï¼‰
}
```

### 2. QuestionClassifier

**èŒè´£ï¼š** å†³å®šä½¿ç”¨å“ªä¸€å±‚çŸ¥è¯†å›ç­”é—®é¢˜

#### ä¸»è¦æ–¹æ³•

```java
@Component
public class QuestionClassifier {
    
    /**
     * åˆ†ç±»é—®é¢˜
     */
    public String classify(String question);
    
    /**
     * è·å–å»ºè®®çš„å±‚çº§
     */
    public String getSuggestedLayer(String questionType);
    
    /**
     * è·å–æ‰€æœ‰é—®é¢˜ç±»å‹
     */
    public List<QuestionTypeConfig> getAllQuestionTypes();
    
    /**
     * æ·»åŠ é—®é¢˜ç±»å‹
     */
    public void addQuestionType(QuestionTypeConfig config);
    
    /**
     * æ›´æ–°é—®é¢˜ç±»å‹
     */
    public void updateQuestionType(QuestionTypeConfig config);
    
    /**
     * åˆ é™¤é—®é¢˜ç±»å‹
     */
    public void deleteQuestionType(String typeName);
}
```

#### åˆ†ç±»é€»è¾‘

1. **å…³é”®è¯åŒ¹é…** - æ£€æŸ¥é—®é¢˜ä¸­æ˜¯å¦åŒ…å«é¢„å®šä¹‰å…³é”®è¯
2. **æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…** - ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é—®é¢˜æ¨¡å¼
3. **é»˜è®¤åˆ†ç±»** - å¦‚æœéƒ½ä¸åŒ¹é…ï¼Œä½¿ç”¨é»˜è®¤ç±»å‹

#### QuestionTypeConfig æ¨¡å‹

```java
@Data
@Builder
public class QuestionTypeConfig {
    private String typeName;              // ç±»å‹åç§°
    private String layer;                 // å±‚çº§ (permanent/ordinary/high_frequency)
    private List<String> keywords;        // å…³é”®è¯åˆ—è¡¨
    private List<String> patterns;        // æ­£åˆ™è¡¨è¾¾å¼åˆ—è¡¨
    private String description;           // æè¿°
}
```

### 3. HopePersistence

**èŒè´£ï¼š** æŒä¹…åŒ–é—®é¢˜ç±»å‹é…ç½®

#### æ¥å£å®šä¹‰

```java
public interface HopePersistence {
    
    /**
     * ä¿å­˜é—®é¢˜ç±»å‹é…ç½®
     */
    void save(QuestionTypeConfig config);
    
    /**
     * æŸ¥æ‰¾é—®é¢˜ç±»å‹é…ç½®
     */
    Optional<QuestionTypeConfig> findByTypeName(String typeName);
    
    /**
     * è·å–æ‰€æœ‰é…ç½®
     */
    List<QuestionTypeConfig> findAll();
    
    /**
     * åˆ é™¤é…ç½®
     */
    void delete(String typeName);
}
```

#### å®ç°ç±»

##### InMemoryHopePersistence

**ç”¨é€”ï¼š** å¼€å‘å’Œæµ‹è¯•

**ç‰¹ç‚¹ï¼š**
- åŸºäºConcurrentHashMap
- æ— æŒä¹…åŒ–
- é‡å¯ä¸¢å¤±

##### KnowledgeRegistryHopePersistence

**ç”¨é€”ï¼š** ç”Ÿäº§ç¯å¢ƒ

**ç‰¹ç‚¹ï¼š**
- åŸºäºKnowledgeRegistry
- æŒä¹…åŒ–åˆ°æ–‡ä»¶/æ•°æ®åº“
- æ”¯æŒå¤šç§åç«¯

---

## ğŸ“š ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

#### 1. æ·»åŠ ä¾èµ–

```xml
<dependency>
    <groupId>top.yumbo.ai.omni</groupId>
    <artifactId>omni-agent-core</artifactId>
    <version>1.0.0</version>
</dependency>
```

#### 2. åŸºæœ¬ä½¿ç”¨

```java
@Autowired
private HOPEKnowledgeManager hopeManager;

// æŸ¥è¯¢çŸ¥è¯†
QueryResult result = hopeManager.query("å¦‚ä½•é…ç½®RAGç³»ç»Ÿï¼Ÿ", 5);

if (result.getSuccess()) {
    System.out.println("é—®é¢˜ç±»å‹: " + result.getQuestionType());
    System.out.println("å»ºè®®å±‚çº§: " + result.getSuggestedLayer());
    System.out.println("ç½®ä¿¡åº¦: " + result.getConfidence());
    System.out.println("æ‰¾åˆ°æ–‡æ¡£æ•°: " + result.getDocuments().size());
}
```

#### 3. æ™ºèƒ½æŸ¥è¯¢ï¼ˆå¸¦ä¸Šä¸‹æ–‡ï¼‰

```java
String context = "ç”¨æˆ·ä¹‹å‰è¯¢é—®è¿‡æ–‡æ¡£å¤„ç†ç›¸å…³çš„é—®é¢˜";
QueryResult result = hopeManager.smartQuery("å¦‚ä½•åˆ†å—ï¼Ÿ", context);
```

### é…ç½®é—®é¢˜ç±»å‹

#### æ·»åŠ è‡ªå®šä¹‰é—®é¢˜ç±»å‹

```java
@Autowired
private QuestionClassifier classifier;

QuestionTypeConfig systemConfig = QuestionTypeConfig.builder()
    .typeName("ç³»ç»Ÿé…ç½®")
    .layer("permanent")
    .keywords(Arrays.asList("é…ç½®", "è®¾ç½®", "ç³»ç»Ÿ", "å‚æ•°"))
    .patterns(Arrays.asList(
        "å¦‚ä½•é…ç½®.*",
        "æ€ä¹ˆè®¾ç½®.*",
        ".*é…ç½®.*"
    ))
    .description("ç³»ç»Ÿé…ç½®ç›¸å…³é—®é¢˜")
    .build();

classifier.addQuestionType(systemConfig);
```

#### é¢„å®šä¹‰é—®é¢˜ç±»å‹ç¤ºä¾‹

```java
// 1. ç³»ç»Ÿé…ç½® - Permanent Layer
QuestionTypeConfig.builder()
    .typeName("ç³»ç»Ÿé…ç½®")
    .layer("permanent")
    .keywords(Arrays.asList("é…ç½®", "è®¾ç½®", "ç³»ç»Ÿ"))
    .build();

// 2. æ–‡æ¡£å¤„ç† - Ordinary Layer
QuestionTypeConfig.builder()
    .typeName("æ–‡æ¡£å¤„ç†")
    .layer("ordinary")
    .keywords(Arrays.asList("æ–‡æ¡£", "PDF", "ä¸Šä¼ ", "å¤„ç†"))
    .build();

// 3. å¸¸è§é—®é¢˜ - High Frequency Layer
QuestionTypeConfig.builder()
    .typeName("å¸¸è§é—®é¢˜")
    .layer("high_frequency")
    .keywords(Arrays.asList("å¦‚ä½•", "æ€ä¹ˆ", "å¿«é€Ÿ", "ç®€å•"))
    .build();
```

### æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

```java
Map<String, LayerStats> stats = hopeManager.getLayerStats();

for (Map.Entry<String, LayerStats> entry : stats.entrySet()) {
    LayerStats stat = entry.getValue();
    System.out.println("å±‚çº§: " + entry.getKey());
    System.out.println("æŸ¥è¯¢æ¬¡æ•°: " + stat.getQueryCount());
    System.out.println("å¹³å‡è€—æ—¶: " + stat.getAverageQueryTime() + "ms");
}
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### æŒä¹…åŒ–é…ç½®

#### ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼ˆé»˜è®¤ï¼‰

```yaml
# application.yml
# é»˜è®¤ä¸éœ€è¦é…ç½®ï¼Œè‡ªåŠ¨ä½¿ç”¨å†…å­˜å­˜å‚¨
```

#### ä½¿ç”¨çŸ¥è¯†æ³¨å†Œè¡¨å­˜å‚¨

```java
@Configuration
public class HopeConfig {
    
    @Bean
    @ConditionalOnProperty(name = "hope.persistence.type", havingValue = "registry")
    public HopePersistence hopePersistence(KnowledgeRegistry registry) {
        return new KnowledgeRegistryHopePersistence(registry);
    }
}
```

```yaml
# application.yml
hope:
  persistence:
    type: registry
```

### è‡ªåŠ¨é…ç½®

HOPEç³»ç»Ÿé€šè¿‡Spring Bootè‡ªåŠ¨é…ç½®å¯ç”¨ï¼š

```
META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports:
top.yumbo.ai.omni.core.hope.config.HopePersistenceAutoConfiguration
```

**é»˜è®¤è¡Œä¸ºï¼š**
- å¦‚æœæ²¡æœ‰é…ç½®`HopePersistence` Beanï¼Œè‡ªåŠ¨åˆ›å»º`InMemoryHopePersistence`
- è‡ªåŠ¨æ³¨å…¥`HOPEKnowledgeManager`å’Œ`QuestionClassifier`

---

## ğŸ“– APIå‚è€ƒ

### HOPEKnowledgeManager API

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| query | String question, int maxResults | QueryResult | åŸºç¡€æŸ¥è¯¢ |
| smartQuery | String question, String context | QueryResult | æ™ºèƒ½æŸ¥è¯¢ï¼ˆå¸¦ä¸Šä¸‹æ–‡ï¼‰ |
| getLayerStats | - | Map<String, LayerStats> | è·å–ç»Ÿè®¡ä¿¡æ¯ |
| resetStats | - | void | é‡ç½®ç»Ÿè®¡ä¿¡æ¯ |

### QuestionClassifier API

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| classify | String question | String | åˆ†ç±»é—®é¢˜ |
| getSuggestedLayer | String questionType | String | è·å–å»ºè®®å±‚çº§ |
| getAllQuestionTypes | - | List<QuestionTypeConfig> | è·å–æ‰€æœ‰ç±»å‹ |
| addQuestionType | QuestionTypeConfig | void | æ·»åŠ ç±»å‹ |
| updateQuestionType | QuestionTypeConfig | void | æ›´æ–°ç±»å‹ |
| deleteQuestionType | String typeName | void | åˆ é™¤ç±»å‹ |

### QueryResult å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| question | String | ç”¨æˆ·é—®é¢˜ |
| questionType | String | é—®é¢˜ç±»å‹ |
| suggestedLayer | String | å»ºè®®çš„å±‚çº§ |
| documents | List<Document> | æ£€ç´¢åˆ°çš„æ–‡æ¡£ |
| queryTimeMs | Long | æŸ¥è¯¢è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰ |
| success | Boolean | æ˜¯å¦æˆåŠŸ |
| confidence | Double | ç½®ä¿¡åº¦ï¼ˆ0.0-1.0ï¼‰ |
| answer | String | å­¦ä¹ ç³»ç»Ÿçš„ç­”æ¡ˆï¼ˆå¯é€‰ï¼‰ |

### LayerStats å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| layerName | String | å±‚çº§åç§° |
| queryCount | Long | æŸ¥è¯¢æ¬¡æ•° |
| totalQueryTime | Long | æ€»æŸ¥è¯¢æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| averageQueryTime | Double | å¹³å‡æŸ¥è¯¢æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |

---

## ğŸ” é«˜çº§è¯é¢˜

### çŸ¥è¯†å±‚çº§ä¼˜åŒ–

æœªæ¥å¯ä»¥åŸºäºä»¥ä¸‹å› ç´ åŠ¨æ€è°ƒæ•´çŸ¥è¯†å±‚çº§ï¼š

1. **è®¿é—®é¢‘ç‡** - é«˜é¢‘è®¿é—®çš„çŸ¥è¯†è‡ªåŠ¨ç§»åˆ°é«˜é¢‘å±‚
2. **æ—¶é—´è¡°å‡** - é•¿æœŸæœªè®¿é—®çš„çŸ¥è¯†é™çº§
3. **é‡è¦æ€§è¯„åˆ†** - åŸºäºç”¨æˆ·åé¦ˆè¯„åˆ†
4. **å­¦ä¹ æ•ˆæœ** - åŸºäºé—®ç­”æ•ˆæœè°ƒæ•´

### ä¸å­¦ä¹ ç³»ç»Ÿé›†æˆ

HOPEç³»ç»Ÿé¢„ç•™äº†å­¦ä¹ ç³»ç»Ÿæ¥å£ï¼š

```java
// QueryResultä¸­çš„answerå­—æ®µ
private String answer; // å­¦ä¹ ç³»ç»Ÿçš„ç­”æ¡ˆ
```

æœªæ¥å¯ä»¥ï¼š
- ä»å­¦ä¹ ç³»ç»Ÿè·å–å·²å­¦ä¹ çš„ç­”æ¡ˆ
- ç›´æ¥è¿”å›ç­”æ¡ˆï¼Œæ— éœ€RAGæ£€ç´¢
- æå‡å“åº”é€Ÿåº¦

### æ€§èƒ½ä¼˜åŒ–

1. **ç¼“å­˜ç­–ç•¥** - é«˜é¢‘é—®é¢˜ç¼“å­˜ç»“æœ
2. **å¹¶è¡ŒæŸ¥è¯¢** - å¤šå±‚åŒæ—¶æŸ¥è¯¢ï¼Œåˆå¹¶ç»“æœ
3. **ç´¢å¼•ä¼˜åŒ–** - ä¸ºæ¯å±‚åˆ›å»ºç‹¬ç«‹ç´¢å¼•

---

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. é—®é¢˜æ— æ³•æ­£ç¡®åˆ†ç±»

**åŸå› ï¼š** ç¼ºå°‘å¯¹åº”çš„é—®é¢˜ç±»å‹é…ç½®

**è§£å†³ï¼š**
```java
// æ·»åŠ æ›´å¤šé—®é¢˜ç±»å‹é…ç½®
classifier.addQuestionType(customConfig);
```

#### 2. æŸ¥è¯¢ç»“æœç½®ä¿¡åº¦ä½

**åŸå› ï¼š** çŸ¥è¯†åº“ä¸­ç¼ºå°‘ç›¸å…³çŸ¥è¯†

**è§£å†³ï¼š**
- è¡¥å……ç›¸å…³æ–‡æ¡£
- æ£€æŸ¥RAGç´¢å¼•æ˜¯å¦æ­£ç¡®æ„å»º

#### 3. ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®

**åŸå› ï¼š** ç»Ÿè®¡æœªé‡ç½®æˆ–æŒä¹…åŒ–é—®é¢˜

**è§£å†³ï¼š**
```java
hopeManager.resetStats(); // é‡ç½®ç»Ÿè®¡
```

---

## ğŸ“ å¾…åŠäº‹é¡¹

### åŠŸèƒ½å¢å¼º

- [ ] æ”¯æŒæœºå™¨å­¦ä¹ åˆ†ç±»ï¼ˆæ›¿ä»£è§„åˆ™åŒ¹é…ï¼‰
- [ ] å®ç°çŸ¥è¯†å±‚çº§è‡ªåŠ¨è°ƒæ•´
- [ ] æ”¯æŒå¤šç§Ÿæˆ·éš”ç¦»
- [ ] æ·»åŠ å¯è§†åŒ–ç»Ÿè®¡ç•Œé¢

### æ–‡æ¡£å®Œå–„

- [ ] æ·»åŠ æ›´å¤šä½¿ç”¨ç¤ºä¾‹
- [ ] æä¾›æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- [ ] ç¼–å†™æœ€ä½³å®è·µæŒ‡å—

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¨¡å—ç´¢å¼•æ–‡æ¡£](../../modules_readme.md)
- [ç¬¬ä¸€æ‰¹æ¨¡å—åˆ†ææŠ¥å‘Š](../MODULE_ANALYSIS_BATCH_01.md)
- [çŸ¥è¯†ç½‘ç»œæ¶æ„è®¾è®¡](./KNOWLEDGE_NETWORK_ARCHITECTURE.md)
- [æ™ºèƒ½é—®ç­”ç³»ç»Ÿè®¾è®¡](./INTELLIGENT_QA_SYSTEM_DESIGN.md)

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0.0  
**æœ€åæ›´æ–°ï¼š** 2025-12-31  
**ç»´æŠ¤è€…ï¼š** OmniAgent Team

