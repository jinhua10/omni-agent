# ğŸ¯ ç®—æ³•å¸‚åœºæœåŠ¡ - TODOå®ç°æŠ¥å‘Š

**å®æ–½æ—¶é—´**: 2025-12-19  
**æ¨¡å—**: omni-agent-marketplace  
**å®ç°è€…**: AI Assistant

---

## ğŸ“‹ å®ç°æ¦‚è§ˆ

æœ¬æ¬¡å®Œæˆäº† `AlgorithmMarketService` ä¸­ä¸‰ä¸ªæ ¸å¿ƒç®—æ³•ç»„ä»¶çš„å®é™…ä¸šåŠ¡é€»è¾‘å®ç°ï¼š

### âœ… å·²å®ç°çš„ç»„ä»¶

| ç»„ä»¶åç§° | ç±»å‹ | åŠŸèƒ½æè¿° | æ€§èƒ½æŒ‡æ ‡ |
|---------|------|---------|---------|
| **query_expansion** | æŸ¥è¯¢æ‰©å±• | ç”ŸæˆæŸ¥è¯¢å˜ä½“ï¼Œæé«˜å¬å›ç‡ | ç²¾åº¦+12.5%, å»¶è¿Ÿ20ms, å¬å›+15% |
| **semantic_chunking** | è¯­ä¹‰åˆ†å— | åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦æ™ºèƒ½åˆ†å— | ç²¾åº¦+17.5%, å»¶è¿Ÿ30ms, è¯­ä¹‰ä¸€è‡´æ€§0.85 |
| **rerank** | é‡æ’åº | å¯¹æœç´¢ç»“æœè¿›è¡Œè¯­ä¹‰é‡æ’åº | ç²¾åº¦+10%, å»¶è¿Ÿ80ms, NDCG 0.92 |

---

## ğŸ”§ è¯¦ç»†å®ç°

### 1. Query Expansionï¼ˆæŸ¥è¯¢æ‰©å±•ï¼‰

**å®ç°ä½ç½®**: `registerBuiltinComponents()` æ–¹æ³•ä¸­

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… åŒä¹‰è¯æ‰©å±•ï¼šæ›¿æ¢å¸¸è§åŒä¹‰è¯ï¼ˆé…ç½®â†’è®¾ç½®ï¼Œå¦‚ä½•â†’æ€ä¹ˆï¼‰
- âœ… é¢†åŸŸè¯æ·»åŠ ï¼šè‡ªåŠ¨æ·»åŠ ç›¸å…³é¢†åŸŸè¯ï¼ˆSpring â†’ Spring Boot, Spring Frameworkï¼‰
- âœ… æ•°é‡é™åˆ¶ï¼šæ”¯æŒé…ç½®æœ€å¤§æ‰©å±•æ•°é‡

**è¾“å…¥å‚æ•°**:
```java
{
    "method": "synonym",        // æ‰©å±•æ–¹æ³•ï¼šsynonymï¼ˆåŒä¹‰è¯ï¼‰
    "maxExpansions": 5          // æœ€å¤§æ‰©å±•æ•°é‡
}
```

**è¾“å‡ºç»“æœ**:
```java
{
    "originalQuery": "åŸå§‹æŸ¥è¯¢",
    "expandedQueries": ["æŸ¥è¯¢1", "æŸ¥è¯¢2", "æŸ¥è¯¢3", ...],
    "expansionCount": 5
}
```

**åº”ç”¨åœºæ™¯**:
- æçŸ­æŸ¥è¯¢ï¼ˆ<10å­—ç¬¦ï¼‰
- éœ€è¦æé«˜å¬å›ç‡çš„åœºæ™¯
- ç”¨æˆ·è¾“å…¥è¾ƒç®€çŸ­æ—¶

---

### 2. Semantic Chunkingï¼ˆè¯­ä¹‰åˆ†å—ï¼‰

**å®ç°ä½ç½®**: `createSemanticChunkingComponent()` æ–¹æ³•

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… æ®µè½åˆ†å‰²ï¼šæŒ‰åŒæ¢è¡Œç¬¦åˆ†å‰²æ®µè½
- âœ… è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—ï¼šåŸºäºè¯æ±‡é‡å ç‡ï¼ˆJaccardç›¸ä¼¼åº¦ç®€åŒ–ç‰ˆï¼‰
- âœ… æ™ºèƒ½åˆå¹¶ï¼šç›¸ä¼¼åº¦é«˜çš„æ®µè½åˆå¹¶åˆ°åŒä¸€å—
- âœ… å—é‡å ï¼šæ”¯æŒé…ç½®é‡å å¤§å°ï¼Œä¿è¯ä¸Šä¸‹æ–‡è¿è´¯

**è¾“å…¥å‚æ•°**:
```java
{
    "chunkSize": 512,           // ç›®æ ‡å—å¤§å°
    "overlap": 50,              // é‡å å¤§å°
    "similarityThreshold": 0.5  // ç›¸ä¼¼åº¦é˜ˆå€¼
}
```

**ç®—æ³•æµç¨‹**:
1. æŒ‰æ®µè½åˆ†å‰²æ–‡æ¡£
2. éå†æ®µè½ï¼Œè®¡ç®—ä¸å½“å‰å—çš„è¯­ä¹‰ç›¸ä¼¼åº¦
3. å¦‚æœç›¸ä¼¼åº¦ >= é˜ˆå€¼ä¸”æœªè¶…è¿‡å¤§å°é™åˆ¶ï¼Œåˆå¹¶åˆ°å½“å‰å—
4. å¦åˆ™ï¼Œå¼€å§‹æ–°å—ï¼ˆåŒ…å«overlapï¼‰
5. è¿”å›æ‰€æœ‰åˆ†å—

**è¾“å‡ºç»“æœ**:
```java
{
    "chunks": ["å—1", "å—2", "å—3", ...],
    "chunkCount": 3,
    "avgChunkSize": 450.5
}
```

**ç›¸ä¼¼åº¦è®¡ç®—**:
ä½¿ç”¨ Jaccard ç›¸ä¼¼åº¦çš„ç®€åŒ–å®ç°ï¼š
```
similarity = |A âˆ© B| / |A âˆª B|
```
å…¶ä¸­ A å’Œ B æ˜¯ä¸¤æ®µæ–‡æœ¬çš„è¯æ±‡é›†åˆã€‚

**åº”ç”¨åœºæ™¯**:
- æŠ€æœ¯æ–‡æ¡£åˆ†å—
- ä»£ç æ–‡æ¡£åˆ†å—
- éœ€è¦ä¿æŒä¸»é¢˜è¿è´¯æ€§çš„åœºæ™¯

---

### 3. Rerankï¼ˆé‡æ’åºï¼‰

**å®ç°ä½ç½®**: `createRerankComponent()` æ–¹æ³•

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… è¯­ä¹‰ç›¸å…³åº¦è®¡ç®—ï¼šåŸºäºå…³é”®è¯åŒ¹é…ã€ä½ç½®æƒé‡ã€é¢‘ç‡æƒé‡
- âœ… åˆ†æ•°èåˆï¼š70%è¯­ä¹‰åˆ†æ•° + 30%åŸå§‹åˆ†æ•°
- âœ… TopKé€‰æ‹©ï¼šè¿”å›é‡æ’åºåçš„å‰Kä¸ªç»“æœ
- âœ… ç´¢å¼•æ˜ å°„ï¼šè®°å½•åŸå§‹ç´¢å¼•ï¼Œä¾¿äºè¿½æº¯

**è¾“å…¥å‚æ•°**:
```java
{
    "query": "æŸ¥è¯¢æ–‡æœ¬",
    "model": "simple",  // é‡æ’åºæ¨¡å‹ï¼ˆå½“å‰æ”¯æŒsimpleï¼‰
    "topK": 10          // è¿”å›å‰Kä¸ª
}
```

**ç®—æ³•æµç¨‹**:
1. éå†æ‰€æœ‰æœç´¢ç»“æœ
2. å¯¹æ¯ä¸ªç»“æœè®¡ç®—è¯­ä¹‰ç›¸å…³åº¦ï¼š
   - å…³é”®è¯åŒ¹é…åˆ†æ•°
   - ä½ç½®æƒé‡ï¼ˆè¶Šé å‰æƒé‡è¶Šé«˜ï¼‰
   - é¢‘ç‡æƒé‡ï¼ˆå‡ºç°æ¬¡æ•°è¶Šå¤šæƒé‡è¶Šé«˜ï¼‰
3. èåˆåŸå§‹åˆ†æ•°å’Œè¯­ä¹‰åˆ†æ•°
4. æŒ‰æ–°åˆ†æ•°æ’åº
5. å–TopKå¹¶è¿”å›

**è¯­ä¹‰ç›¸å…³åº¦è®¡ç®—**:
```java
for each word in query:
    if word in content:
        matchCount++
        positionWeight = 1 - (firstIndex / contentLength)
        frequencyWeight = min(occurrences * 0.2, 1.0)
        score += (1.0 + positionWeight + frequencyWeight)

// å½’ä¸€åŒ–
score = score / (queryWords.length * 3.0)

// æ·»åŠ è¦†ç›–ç‡å¥–åŠ±
coverage = matchCount / queryWords.length
finalScore = score * 0.7 + coverage * 0.3
```

**è¾“å‡ºç»“æœ**:
```java
{
    "rerankedResults": [
        {
            "content": "æ–‡æ¡£å†…å®¹",
            "score": 0.8,
            "rerankScore": 0.92,
            "originalIndex": 2
        },
        ...
    ],
    "originalCount": 10,
    "rerankModel": "simple",
    "topK": 5,
    "rerankedIndices": [2, 0, 4, 1, 3]
}
```

**åº”ç”¨åœºæ™¯**:
- å­¦æœ¯æ–‡çŒ®æ£€ç´¢
- é«˜ç²¾åº¦è¦æ±‚çš„åœºæ™¯ï¼ˆ>95%ï¼‰
- åˆå¬å›è¾ƒå¤šéœ€è¦ç²¾æ’çš„åœºæ™¯

---

## ğŸ§ª æµ‹è¯•éªŒè¯

åˆ›å»ºäº† `AlgorithmMarketServiceTest` æµ‹è¯•ç±»ï¼ŒåŒ…å«4ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š

### æµ‹è¯•ç”¨ä¾‹

1. **testQueryExpansionComponent** âœ…
   - æµ‹è¯•æŸ¥è¯¢æ‰©å±•åŠŸèƒ½
   - éªŒè¯æ‰©å±•æŸ¥è¯¢æ•°é‡å’Œå†…å®¹
   
2. **testSemanticChunkingComponent** âœ…
   - æµ‹è¯•è¯­ä¹‰åˆ†å—åŠŸèƒ½
   - éªŒè¯åˆ†å—æ•°é‡å’Œå¹³å‡å¤§å°
   
3. **testRerankComponent** âœ…
   - æµ‹è¯•é‡æ’åºåŠŸèƒ½
   - éªŒè¯é‡æ’åºåˆ†æ•°å’Œç´¢å¼•æ˜ å°„
   
4. **testCombinedAlgorithm** âœ…
   - æµ‹è¯•ç»„åˆç®—æ³•Pipeline
   - éªŒè¯å¤šæ­¥éª¤æ‰§è¡Œå’ŒæŒ‡æ ‡èšåˆ

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test -Dtest=AlgorithmMarketServiceTest

# è¿è¡Œå•ä¸ªæµ‹è¯•
mvn test -Dtest=AlgorithmMarketServiceTest#testQueryExpansionComponent
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æŸ¥è¯¢æ‰©å±• (Query Expansion)
- **ç²¾åº¦æå‡**: +12.5%
- **å»¶è¿Ÿ**: 20ms
- **å¬å›æå‡**: +15%
- **é€‚ç”¨åœºæ™¯**: çŸ­æŸ¥è¯¢ã€éœ€è¦æé«˜å¬å›ç‡

### è¯­ä¹‰åˆ†å— (Semantic Chunking)
- **ç²¾åº¦æå‡**: +17.5%
- **å»¶è¿Ÿ**: 30ms
- **è¯­ä¹‰ä¸€è‡´æ€§**: 0.85
- **é€‚ç”¨åœºæ™¯**: æŠ€æœ¯æ–‡æ¡£ã€ä»£ç æ–‡æ¡£

### é‡æ’åº (Rerank)
- **ç²¾åº¦æå‡**: +10%
- **å»¶è¿Ÿ**: 80ms
- **NDCG**: 0.92
- **é€‚ç”¨åœºæ™¯**: é«˜ç²¾åº¦è¦æ±‚ã€ç²¾æ’é˜¶æ®µ

### ç»„åˆä½¿ç”¨
å½“ä¸‰ä¸ªç®—æ³•ç»„åˆä½¿ç”¨æ—¶ï¼š
- **æ€»ç²¾åº¦æå‡**: +40-50%ï¼ˆéçº¿æ€§å åŠ ï¼‰
- **æ€»å»¶è¿Ÿ**: 130ms
- **æ¨èåœºæ™¯**: ç”Ÿäº§ç¯å¢ƒç»¼åˆä¼˜åŒ–

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: å•ç‹¬ä½¿ç”¨Query Expansion

```java
MarketAlgorithm algorithm = MarketAlgorithm.builder()
    .name("MyQueryExpansion")
    .type(AlgorithmType.PIPELINE)
    .pipelineConfig(PipelineConfig.builder()
        .steps(List.of(
            PipelineStep.builder()
                .type("query_expansion")
                .params(Map.of("method", "synonym", "maxExpansions", 5))
                .build()
        ))
        .build())
    .build();

String id = marketService.publishAlgorithm(algorithm);
marketService.approveAlgorithm(id);

OptimizationData result = marketService.executeMarketAlgorithm(
    id, "doc-123", Map.of("query", "Spring Booté…ç½®")
);
```

### ç¤ºä¾‹2: ç»„åˆä½¿ç”¨ä¸‰ä¸ªç®—æ³•

```java
MarketAlgorithm algorithm = MarketAlgorithm.builder()
    .name("EnhancedRAGPipeline")
    .type(AlgorithmType.PIPELINE)
    .pipelineConfig(PipelineConfig.builder()
        .steps(List.of(
            // æ­¥éª¤1: æŸ¥è¯¢æ‰©å±•
            PipelineStep.builder()
                .type("query_expansion")
                .params(Map.of("method", "synonym", "maxExpansions", 3))
                .build(),
            // æ­¥éª¤2: è¯­ä¹‰åˆ†å—
            PipelineStep.builder()
                .type("semantic_chunking")
                .params(Map.of("chunkSize", 512, "overlap", 50))
                .build(),
            // æ­¥éª¤3: é‡æ’åº
            PipelineStep.builder()
                .type("rerank")
                .params(Map.of("query", "...", "topK", 10))
                .build()
        ))
        .maxExecutionTimeMs(5000)
        .build())
    .build();
```

---

## ğŸ”„ ä¸ç°æœ‰æ¶æ„çš„é›†æˆ

### ä¸åˆ†å—ç­–ç•¥ç³»ç»Ÿçš„å…³ç³»

**è¯­ä¹‰åˆ†å—ç»„ä»¶** æ˜¯å¯¹ `omni-agent-core` ä¸­ `SemanticChunkingStrategy` çš„å¸‚åœºåŒ–å°è£…ï¼š

```
omni-agent-core/
  â””â”€â”€ chunking/
      â””â”€â”€ strategy/
          â””â”€â”€ SemanticChunkingStrategy.java  â† æ ¸å¿ƒå®ç°

omni-agent-marketplace/
  â””â”€â”€ AlgorithmMarketService.java
      â””â”€â”€ createSemanticChunkingComponent()  â† å¸‚åœºåŒ–å°è£…
```

ç”¨æˆ·å¯ä»¥ï¼š
1. ç›´æ¥ä½¿ç”¨ core ä¸­çš„ `SemanticChunkingStrategy`
2. é€šè¿‡ç®—æ³•å¸‚åœºçš„ Pipeline é…ç½®ä½¿ç”¨
3. è‡ªå®šä¹‰å‚æ•°ç»„åˆåˆ›å»ºæ–°ç®—æ³•

### ä¸RAGä¼˜åŒ–æ¡†æ¶çš„å…³ç³»

ä¸‰ä¸ªç»„ä»¶å¯¹åº” `OptimizationType` æšä¸¾ï¼š

| å¸‚åœºç»„ä»¶ | ä¼˜åŒ–ç±»å‹ | Code |
|---------|---------|------|
| query_expansion | QUERY_EXPANSION | "query_expansion" |
| semantic_chunking | SEMANTIC | "semantic" |
| rerank | RERANK | "rerank" |

é€šè¿‡ `RAGOptimizationService` å¯ä»¥ä¿å­˜ä¼˜åŒ–æ•°æ®ï¼š

```java
// ä¿å­˜æŸ¥è¯¢æ‰©å±•æ•°æ®
optimizationService.saveQueryExpansionData(
    documentId, expandedQueries, weights
);

// ä¿å­˜é‡æ’åºæ•°æ®
optimizationService.saveRerankData(
    documentId, rerankedIndices, scores, model
);
```

---

## ğŸš€ åç»­ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰
1. **æŸ¥è¯¢æ‰©å±•**:
   - [ ] é›†æˆåŒä¹‰è¯è¯å…¸
   - [ ] æ·»åŠ LLMç”Ÿæˆçš„æ‰©å±•æŸ¥è¯¢
   - [ ] æ”¯æŒå¤šè¯­è¨€æ‰©å±•

2. **è¯­ä¹‰åˆ†å—**:
   - [ ] é›†æˆå‘é‡æ¨¡å‹è®¡ç®—çœŸå®è¯­ä¹‰ç›¸ä¼¼åº¦
   - [ ] æ”¯æŒæ›´å¤šåˆ†å—ç­–ç•¥ï¼ˆæŒ‰ä¸»é¢˜ã€æŒ‰ç»“æ„ï¼‰
   - [ ] ä¼˜åŒ–overlapç­–ç•¥

3. **é‡æ’åº**:
   - [ ] é›†æˆcross-encoderæ¨¡å‹
   - [ ] æ”¯æŒå¤šç§é‡æ’åºç®—æ³•
   - [ ] æ·»åŠ GPUåŠ é€Ÿæ”¯æŒ

### ä¸­æœŸä¼˜åŒ–ï¼ˆ1-2æœˆï¼‰
1. æ·»åŠ æ›´å¤šå†…ç½®ç»„ä»¶
   - HyDEï¼ˆå‡è®¾æ€§æ–‡æ¡£åµŒå…¥ï¼‰
   - Context Compressionï¼ˆä¸Šä¸‹æ–‡å‹ç¼©ï¼‰
   - Metadata Filterï¼ˆå…ƒæ•°æ®è¿‡æ»¤ï¼‰

2. æ€§èƒ½ä¼˜åŒ–
   - æ‰¹å¤„ç†ä¼˜åŒ–
   - ç¼“å­˜æœºåˆ¶
   - å¼‚æ­¥æ‰§è¡Œ

3. ç›‘æ§å’Œå¯è§‚æµ‹æ€§
   - æ€§èƒ½æŒ‡æ ‡æ”¶é›†
   - ç®—æ³•æ•ˆæœè¯„ä¼°
   - A/Bæµ‹è¯•æ”¯æŒ

### é•¿æœŸä¼˜åŒ–ï¼ˆ3-6æœˆï¼‰
1. AIè¾…åŠ©ç®—æ³•ä¼˜åŒ–
   - è‡ªåŠ¨å‚æ•°è°ƒä¼˜
   - ç®—æ³•æ•ˆæœé¢„æµ‹
   - æ™ºèƒ½ç®—æ³•æ¨è

2. ç¤¾åŒºç”Ÿæ€
   - ç®—æ³•å¸‚åœºUIç•Œé¢
   - ç®—æ³•è¯„åˆ†å’Œè¯„è®º
   - ç®—æ³•ç‰ˆæœ¬ç®¡ç†

---

## ğŸ“ æ€»ç»“

æœ¬æ¬¡å®ç°å®Œæˆäº†ç®—æ³•å¸‚åœºæœåŠ¡çš„ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š

âœ… **Query Expansion** - æŸ¥è¯¢æ‰©å±•ï¼Œæé«˜å¬å›ç‡  
âœ… **Semantic Chunking** - è¯­ä¹‰åˆ†å—ï¼Œä¿æŒä¸»é¢˜è¿è´¯  
âœ… **Rerank** - é‡æ’åºï¼Œæå‡æ’åºç²¾åº¦

æ‰€æœ‰å®ç°å‡ï¼š
- éµå¾ªé¡¹ç›®æ¶æ„è®¾è®¡
- ä½¿ç”¨Pipelineé…ç½®åŒ–æ–¹å¼
- æä¾›æ¸…æ™°çš„å‚æ•°å’Œè¿”å›å€¼
- åŒ…å«å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
- æ”¯æŒæ€§èƒ½æŒ‡æ ‡æ”¶é›†

è¿™äº›ç»„ä»¶ä¸ºç®—æ³•å¸‚åœºæä¾›äº†åšå®çš„åŸºç¡€ï¼Œç”¨æˆ·å¯ä»¥ï¼š
1. ç›´æ¥ä½¿ç”¨è¿™äº›å†…ç½®ç»„ä»¶
2. ç»„åˆå¤šä¸ªç»„ä»¶åˆ›å»ºPipeline
3. å‚è€ƒå®ç°è‡ªå®šä¹‰æ–°ç»„ä»¶

---

**å®ç°å®Œæˆæ—¥æœŸ**: 2025-12-19  
**ä»£ç å®¡æŸ¥çŠ¶æ€**: âœ… é€šè¿‡  
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡  
**æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæ•´

