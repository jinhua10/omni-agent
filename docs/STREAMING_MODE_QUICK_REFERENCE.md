# 流式 vs 批量模式 - 快速参考

## 🎯 一图看懂

```
┌─────────────────────────────────────────────────────────────────┐
│                    文本提取模式选择                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  📄 您的文档是？                                                 │
│                                                                 │
│  ┌──────────────┐              ┌──────────────┐               │
│  │  大文档       │              │  小文档       │               │
│  │  • PPT       │              │  • TXT       │               │
│  │  • PDF (多页) │     VS      │  • Markdown  │               │
│  │  • Word (长)  │              │  • 纯文本     │               │
│  │  • Excel     │              │  • 短文档     │               │
│  └──────────────┘              └──────────────┘               │
│         ↓                              ↓                       │
│  ┌──────────────┐              ┌──────────────┐               │
│  │ 推荐：流式    │              │ 推荐：批量    │               │
│  │ ⚡ 实时显示   │              │ 📦 按页显示   │               │
│  └──────────────┘              └──────────────┘               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## ⚡ 流式模式

### 特点
- ✅ 边提取边显示，秒级响应
- ✅ 减少等待焦虑
- ✅ 适合大文档（10+ 页）
- ✅ Vision LLM 推荐使用

### 工作原理
```
页面1 开始 → token1 → token2 → token3 → ... → 页面1 完成
                ↓        ↓        ↓
              前端显示  前端显示  前端显示
                                    ↓
页面2 开始 → token1 → token2 → ... → 页面2 完成
```

### UI 表现
```
提取中...
═══════════════════════════════════════
=== 页面 1 ===
这是第一页的内容，正在逐字显示▌
```

## 📦 批量模式

### 特点
- ✅ 按页显示，内容完整
- ✅ 网络流量少
- ✅ 适合小文档（1-5 页）
- ✅ 标准提取推荐使用

### 工作原理
```
页面1 开始 → 处理中... → 页面1 完成
                           ↓
                        前端显示整页
                           ↓
页面2 开始 → 处理中... → 页面2 完成
                           ↓
                        前端显示整页
```

### UI 表现
```
提取中...
═══════════════════════════════════════
=== 页面 1 ===
这是第一页的完整内容

=== 页面 2 ===
这是第二页的完整内容▌
```

## 🎨 UI 操作指南

### 开关位置
```
文本提取配置
├─ 选择模型: [Vision LLM ▼]
├─ 输出模式: 
│  ⚡ 流式输出  [流式 ◉ | 批量 ○]
│  💡 边提取边显示，适合大文档
└─ [🚀 开始提取]
```

### 切换步骤
1. 点击开关切换"流式"或"批量"
2. 查看提示文字确认模式
3. 点击"开始提取"

## 📊 性能对比

| 指标 | 流式模式 | 批量模式 |
|------|---------|---------|
| 首屏时间 | ⚡ 1-3秒 | 🐢 10-30秒/页 |
| 完成时间 | 相同 | 相同 |
| 网络包数 | 多（小包） | 少（中包） |
| CPU 占用 | 均匀 | 突发 |
| 内存占用 | 低 | 中 |
| 用户满意度 | 高 | 中 |

## 🔍 如何选择？

### 选择流式模式的场景
- 📄 文档超过 5 页
- 🖼️ 含有大量图片/图表
- ⏱️ 用户不想等待
- 💼 演示/展示场景
- 🎯 使用 Vision LLM

### 选择批量模式的场景
- 📝 纯文本文档
- 📄 文档少于 3 页
- 🌐 网络不稳定
- 💻 性能受限设备
- 📋 标准提取模式

## 🚨 常见问题

### Q: 为什么流式模式还是很慢？
A: 流式模式只是"边处理边显示"，不会加快 Vision LLM 的推理速度。但用户体验会好很多，因为可以看到进度。

### Q: 批量模式会一次显示全部内容吗？
A: 不会！批量模式是"按页显示"，每页完成就显示一页，而不是等全部完成。

### Q: 可以中途切换模式吗？
A: 不可以。提取过程中开关会被禁用。需要等待当前提取完成后才能切换。

### Q: 哪种模式更省流量？
A: 批量模式略省流量（发送的包数更少），但差异不大。建议优先考虑用户体验。

### Q: 默认使用哪种模式？
A: 默认使用流式模式，因为大多数场景下用户体验更好。

## 💡 最佳实践

1. **大文档必选流式**：超过 10 页的 PPT/PDF 强烈建议流式
2. **小文档随意**：3 页以内的文档两种模式差异不大
3. **网络不好选批量**：不稳定网络下批量模式更可靠
4. **演示场景选流式**：给客户演示时，流式效果更炫酷

## 🎓 技术原理（给开发者）

### 流式模式技术栈
```
后端: Flux<String> → SSE
前端: EventSource → 实时渲染
```

### 批量模式技术栈
```
后端: 每页完成 → callback → SSE
前端: EventSource → 按页渲染
```

### 关键代码
```java
// 后端判断逻辑
if (streamingMode) {
    // 使用 chatWithVisionFlux 逐 token 推送
    serviceToUse.chatWithVisionFlux(messages)
        .doOnNext(token -> callback.accept(token))
        .blockLast();
} else {
    // 完整内容一次性推送
    String result = serviceToUse.analyzeImages(...);
    callback.accept(result);
}
```

```javascript
// 前端接收逻辑
if (data.type === 'content') {
    // 无论流式还是批量，都实时累加显示
    setExtractionResult(prev => prev + data.content)
}
```

## 📞 需要帮助？

- 查看完整文档：`STREAMING_MODE_FEATURE.md`
- 提交问题：GitHub Issues
- 技术支持：OmniAgent Team

