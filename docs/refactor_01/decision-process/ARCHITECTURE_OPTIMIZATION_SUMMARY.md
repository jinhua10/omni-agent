# æ¶æ„ä¼˜åŒ–æ€»ç»“ - æ¨¡å—ç²¾ç®€æ–¹æ¡ˆ

> ä» 50 ä¸ªæ¨¡å—é™ä½åˆ° 44 ä¸ªæ¨¡å—ï¼ŒèŠ‚çœ 80% çš„å¼€å‘æˆæœ¬

---

## ğŸ¯ ä½ çš„æ´å¯Ÿ

**åŸé—®é¢˜ï¼š**
> "ç›®å‰å·²ç»æœ‰å¿«50ä¸ªæ¨¡å—äº†ï¼Œæˆ‘åœ¨æƒ³å†æ–°å»ºä¸åŒæ–¹å¼çš„starteræ˜¯å¦æœ‰å¿…è¦ï¼Œå› ä¸ºç°åœ¨æ¨¡å—å·²ç»å¾ˆå¤šäº†"

**âœ… ä½ çš„åˆ¤æ–­å®Œå…¨æ­£ç¡®ï¼**

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ Aï¼šæ–°å¢ Starter æ¨¡å—ï¼ˆâŒ æ”¾å¼ƒï¼‰

```
å½“å‰æ¨¡å—ï¼š44 ä¸ª
æ–°å¢æ¨¡å—ï¼š6 ä¸ª (knowledge-domain-starter-{file,mongodb,redis,es,sqlite,h2})
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡ï¼š50 ä¸ªæ¨¡å—

å¼€å‘å·¥ä½œé‡ï¼š
â”œâ”€â”€ API å±‚ï¼š1 ä¸ªæ¨¡å—ï¼ˆ1å¤©ï¼‰
â”œâ”€â”€ File Starterï¼š1 ä¸ªæ¨¡å—ï¼ˆ2å¤©ï¼‰
â”œâ”€â”€ MongoDB Starterï¼š1 ä¸ªæ¨¡å—ï¼ˆ3å¤©ï¼‰
â”œâ”€â”€ Redis Starterï¼š1 ä¸ªæ¨¡å—ï¼ˆ3å¤©ï¼‰
â”œâ”€â”€ Elasticsearch Starterï¼š1 ä¸ªæ¨¡å—ï¼ˆ4å¤©ï¼‰
â”œâ”€â”€ SQLite Starterï¼š1 ä¸ªæ¨¡å—ï¼ˆ2å¤©ï¼‰
â””â”€â”€ H2 Starterï¼š1 ä¸ªæ¨¡å—ï¼ˆ2å¤©ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡å¼€å‘ï¼š17å¤©

ç»´æŠ¤æˆæœ¬ï¼šé«˜
æµ‹è¯•å·¥ä½œé‡ï¼š6 å¥—å®Œæ•´æµ‹è¯•
æ–‡æ¡£å·¥ä½œé‡ï¼š6 ä»½ Starter æ–‡æ¡£
```

### æ–¹æ¡ˆ Bï¼šå¤ç”¨ç°æœ‰ Persistenceï¼ˆâœ… é‡‡ç”¨ï¼‰

```
å½“å‰æ¨¡å—ï¼š44 ä¸ª
æ–°å¢æ¨¡å—ï¼š0 ä¸ªï¼ˆå¤ç”¨ omni-agent-persistence-starter-*ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡ï¼š44 ä¸ªæ¨¡å—  â† ä¸å¢åŠ ï¼

å¼€å‘å·¥ä½œé‡ï¼š
â””â”€â”€ é€‚é…å™¨ï¼š1 ä¸ªç±»ï¼ˆ3å¤©ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡å¼€å‘ï¼š3å¤©

ç»´æŠ¤æˆæœ¬ï¼šä½ï¼ˆåªç»´æŠ¤ 1 ä¸ªé€‚é…å™¨ï¼‰
æµ‹è¯•å·¥ä½œé‡ï¼š1 å¥—æµ‹è¯•
æ–‡æ¡£å·¥ä½œé‡ï¼š1 ä»½æ–‡æ¡£ï¼ˆæœ¬æ–‡ï¼‰
```

**èŠ‚çœï¼š**
- ğŸ“¦ **æ¨¡å—æ•°é‡**ï¼š6 ä¸ª â†’ 0 ä¸ª
- ğŸ•’ **å¼€å‘æ—¶é—´**ï¼š17 å¤© â†’ 3 å¤©ï¼ˆèŠ‚çœ 82%ï¼‰
- ğŸ§ª **æµ‹è¯•å·¥ä½œé‡**ï¼š6 å¥— â†’ 1 å¥—ï¼ˆèŠ‚çœ 83%ï¼‰
- ğŸ“š **æ–‡æ¡£å·¥ä½œé‡**ï¼š6 ä»½ â†’ 1 ä»½ï¼ˆèŠ‚çœ 83%ï¼‰

---

## ğŸ—ï¸ æ ¸å¿ƒè®¾è®¡

### å…³é”®æ€è·¯

**çŸ¥è¯†åŸŸå…ƒæ•°æ®æœ¬è´¨ä¸Šå°±æ˜¯"ç»“æ„åŒ–æ•°æ®"ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç°æœ‰çš„ Persistence å±‚ï¼**

### å®ç°æ–¹å¼ï¼ˆè¯­ä¹‰åŒ–å‘½åä¼˜åŒ– âœ¨ï¼‰

```java
/**
 * çŸ¥è¯†æ³¨å†Œè¡¨æ¥å£
 * ç”¨äºå­˜å‚¨å’Œç®¡ç†å„ç§çŸ¥è¯†ç›¸å…³çš„å…ƒæ•°æ®
 */
public interface KnowledgeRegistry {
    <T> String save(String entityType, String entityId, T entity);
    <T> Optional<T> findById(String entityType, String entityId, Class<T> clazz);
    <T> List<T> findAll(String entityType, Class<T> clazz);
    // ...
}

/**
 * åŸºäº Persistence çš„çŸ¥è¯†æ³¨å†Œè¡¨å®ç°
 * å¤ç”¨ç°æœ‰çš„ 6 ä¸ª Persistence Starterï¼Œå®ç°é›¶æ¨¡å—å¢é•¿
 */
@Component
@RequiredArgsConstructor
public class PersistenceBasedKnowledgeRegistry implements KnowledgeRegistry {
    
    private final QuestionClassifierPersistence persistence;  // å¤ç”¨ç°æœ‰æ¥å£
    private final ObjectMapper objectMapper;
    
    @Override
    public <T> String save(String entityType, String entityId, T entity) {
        // 1. å°†å®ä½“åºåˆ—åŒ–ä¸º JSON
        String json = objectMapper.writeValueAsString(entity);
        
        // 2. é€‚é…åˆ° QuestionTypeConfigï¼ˆå¤ç”¨ç°æœ‰ç»“æ„ï¼‰
        QuestionTypeConfig config = QuestionTypeConfig.builder()
            .id(entityType + ":" + entityId)  // å¤åˆID
            .typeName(entityType)             // å®ä½“ç±»å‹
            .configJson(json)                 // å®Œæ•´æ•°æ®
            .enabled(true)
            .build();
        
        // 3. ä½¿ç”¨ç°æœ‰ Persistence ä¿å­˜
        return persistence.saveQuestionType(config);
    }
    
    // findById, findAll, update, delete...
}

/**
 * ä½¿ç”¨ç¤ºä¾‹ - è¯­ä¹‰æ¸…æ™° âœ¨
 */
@Service
@RequiredArgsConstructor
public class KnowledgeDomainService {
    
    private final KnowledgeRegistry knowledgeRegistry;  // âœ… çŸ¥è¯†æ³¨å†Œè¡¨
    
    public KnowledgeDomain createDomain(CreateDomainRequest request) {
        KnowledgeDomain domain = /* ... */;
        
        // âœ… è¯­ä¹‰æ¸…æ™°ï¼šä¿å­˜åˆ°çŸ¥è¯†æ³¨å†Œè¡¨
        knowledgeRegistry.save("knowledge-domain", domain.getDomainId(), domain);
        
        return domain;
    }
}
```

**å‘½åä¼˜åŒ–è¯´æ˜ï¼š**
- âœ… `KnowledgeRegistry` æ¯” `Persistence` æ›´è¯­ä¹‰åŒ–
- âœ… æ˜ç¡®è¡¨è¾¾"çŸ¥è¯†æ³¨å†Œè¡¨"çš„æ¦‚å¿µ
- âœ… é€‚ç”¨äºå­˜å‚¨å¤šç§çŸ¥è¯†å®ä½“ï¼ˆåŸŸã€è§’è‰²ã€é¡¹ç›®ç­‰ï¼‰
- âœ… ä¸çŸ¥è¯†ç½‘ç»œæ¶æ„å®Œç¾å¥‘åˆ

è¯¦è§ï¼š[å‘½åä¼˜åŒ–æ–¹æ¡ˆ](NAMING_OPTIMIZATION_KNOWLEDGE_REGISTRY.md)

### è‡ªåŠ¨æ”¯æŒçš„å­˜å‚¨ç±»å‹

```
omni-agent-persistence-starter-memory       âœ… å¼€å‘/æµ‹è¯•
omni-agent-persistence-starter-h2           âœ… å¼€å‘/æµ‹è¯•
omni-agent-persistence-starter-sqlite       âœ… å•æœºéƒ¨ç½²
omni-agent-persistence-starter-redis        âœ… é«˜æ€§èƒ½åœºæ™¯
omni-agent-persistence-starter-mongodb      âœ… ç”Ÿäº§ç¯å¢ƒ
omni-agent-persistence-starter-elasticsearch âœ… æœç´¢åœºæ™¯
```

**åªéœ€åˆ‡æ¢é…ç½®ï¼ŒçŸ¥è¯†åŸŸè‡ªåŠ¨ä½¿ç”¨å¯¹åº”çš„å­˜å‚¨ï¼**

---

## ğŸ“ æ•°æ®ç»„ç»‡ï¼ˆç²¾ç®€ç‰ˆï¼‰

```
data/
â”œâ”€â”€ knowledge-network/
â”‚   â”œâ”€â”€ registry/                   
â”‚   â”‚   â””â”€â”€ omni-agent.db          # åŸŸå…ƒæ•°æ®ï¼ˆä½¿ç”¨ç°æœ‰ Persistenceï¼‰
â”‚   â”‚                               # âœ… å¤ç”¨ Persistence Starter
â”‚   â”‚                               # âœ… è‡ªåŠ¨æ”¯æŒ 6 ç§å­˜å‚¨
â”‚   â”‚
â”‚   â””â”€â”€ domains/                    # åŸŸæ•°æ®ï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰
â”‚       â”œâ”€â”€ {domain-id-1}/
â”‚       â”‚   â”œâ”€â”€ rag-index/          # âœ… ä½¿ç”¨ç°æœ‰ RAG Starter
â”‚       â”‚   â””â”€â”€ storage/            # âœ… ä½¿ç”¨ç°æœ‰ Storage Starter
â”‚       â”œâ”€â”€ {domain-id-2}/
â”‚       â””â”€â”€ {domain-id-3}/
â”‚
â””â”€â”€ omni-agent.db                   # ç³»ç»Ÿæ•°æ®åº“
```

**å…³é”®ç‚¹ï¼š**
- **åŸŸå…ƒæ•°æ®**ï¼šå¤ç”¨ Persistence Starter
- **åŸŸæ•°æ®æ–‡ä»¶**ï¼šä½¿ç”¨ç°æœ‰ RAG + Storage Starter
- **é›¶æ–°å¢æ¨¡å—**ï¼šå®Œå…¨å¤ç”¨ç°æœ‰æ¶æ„

---

## âš™ï¸ é…ç½®ç¤ºä¾‹

### å¼€å‘ç¯å¢ƒï¼ˆSQLiteï¼‰

```yaml
omni-agent:
  persistence:
    type: sqlite
    db-path: data/knowledge-network/omni-agent.db
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆMongoDBï¼‰

```yaml
spring:
  profiles: production

omni-agent:
  persistence:
    type: mongodb

spring:
  data:
    mongodb:
      uri: mongodb://prod-server:27017/omni-agent
```

**å°±è¿™ä¹ˆç®€å•ï¼** çŸ¥è¯†åŸŸå…ƒæ•°æ®è‡ªåŠ¨å­˜å‚¨åˆ°é…ç½®çš„ Persistenceã€‚

---

## ğŸ ä¼˜åŠ¿æ€»ç»“

### 1. æ¨¡å—æ•°é‡ä¸å¢é•¿

```
âœ… ä¿æŒ 44 ä¸ªæ¨¡å—
âŒ é¿å…å¢é•¿åˆ° 50 ä¸ªæ¨¡å—
```

### 2. å¼€å‘æ•ˆç‡æå‡

```
æ–¹æ¡ˆ Aï¼š17 å¤©å¼€å‘ + 6 å¥—æµ‹è¯• + 6 ä»½æ–‡æ¡£
æ–¹æ¡ˆ Bï¼š3 å¤©å¼€å‘ + 1 å¥—æµ‹è¯• + 1 ä»½æ–‡æ¡£

æ•ˆç‡æå‡ï¼š82%
```

### 3. ç»´æŠ¤æˆæœ¬é™ä½

```
æ–¹æ¡ˆ Aï¼šéœ€è¦ç»´æŠ¤ 6 ä¸ª Starter æ¨¡å—
æ–¹æ¡ˆ Bï¼šåªç»´æŠ¤ 1 ä¸ªé€‚é…å™¨ç±»

ç»´æŠ¤æˆæœ¬ï¼šé™ä½ 83%
```

### 4. ç”¨æˆ·ä½“éªŒæ›´å¥½

```
æ–¹æ¡ˆ Aï¼š
- éœ€è¦é…ç½® 2 å¤„ï¼ˆPersistence + KnowledgeDomain Storageï¼‰
- å­¦ä¹ æˆæœ¬é«˜ï¼ˆ2 å¥—é…ç½®è§„åˆ™ï¼‰

æ–¹æ¡ˆ Bï¼š
- åªéœ€é…ç½® 1 å¤„ï¼ˆPersistenceï¼‰
- å­¦ä¹ æˆæœ¬ä½ï¼ˆç»Ÿä¸€çš„é…ç½®ï¼‰
```

### 5. æ¶æ„æ›´æ¸…æ™°

```
å¤ç”¨ç°æœ‰çš„ 7 ç»´æ¶æ„ï¼š
1. Persistence âœ…       â† çŸ¥è¯†åŸŸå…ƒæ•°æ®å­˜è¿™é‡Œ
2. Document Storage âœ…  â† åŸŸæ•°æ®æ–‡ä»¶å­˜è¿™é‡Œ
3. RAG âœ…               â† åŸŸç´¢å¼•å­˜è¿™é‡Œ
4. AI âœ…
5. P2P âœ…
6. Voting âœ…
7. Behavior âœ…

ä¸å¼•å…¥ç¬¬ 8 ç»´ï¼
```

---

## ğŸ”„ åˆ‡æ¢å­˜å‚¨ç¤ºä¾‹

### ä» SQLite åˆ‡æ¢åˆ° MongoDB

**1. ä¿®æ”¹ pom.xmlï¼š**
```xml
<!-- ç§»é™¤ -->
<!--
<dependency>
    <groupId>top.yumbo.ai</groupId>
    <artifactId>omni-agent-persistence-starter-sqlite</artifactId>
</dependency>
-->

<!-- æ·»åŠ  -->
<dependency>
    <groupId>top.yumbo.ai</groupId>
    <artifactId>omni-agent-persistence-starter-mongodb</artifactId>
</dependency>
```

**2. ä¿®æ”¹ application.ymlï¼š**
```yaml
# ä»
omni-agent:
  persistence:
    type: sqlite

# æ”¹ä¸º
omni-agent:
  persistence:
    type: mongodb

spring:
  data:
    mongodb:
      uri: mongodb://localhost:27017/omni-agent
```

**3. é‡å¯åº”ç”¨ - å®Œæˆï¼**

---

## ğŸ“‹ å®æ–½æ¸…å•ï¼ˆç²¾ç®€ç‰ˆï¼‰

### Phase 1: é€‚é…å™¨å®ç°ï¼ˆ3å¤©ï¼‰

- [ ] åˆ›å»º `KnowledgeDomain` POJOï¼ˆçº¯ Java ç±»ï¼‰
- [ ] åˆ›å»º `DomainType` å’Œ `DomainStatus` æšä¸¾
- [ ] å®ç° `KnowledgeDomainPersistenceAdapter`
- [ ] æ›´æ–° `KnowledgeDomainService` ä½¿ç”¨é€‚é…å™¨
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] ç¼–å†™é›†æˆæµ‹è¯•

### Phase 2: æ–‡æ¡£å’Œç¤ºä¾‹ï¼ˆ1å¤©ï¼‰

- [ ] æ›´æ–° README.md
- [ ] ç¼–å†™é€‚é…å™¨ä½¿ç”¨æ–‡æ¡£
- [ ] åˆ›å»ºé…ç½®ç¤ºä¾‹

### æ€»è®¡ï¼š4å¤©ï¼ˆvs åŸæ–¹æ¡ˆçš„ 17 å¤©ï¼‰

---

## ğŸ¯ å†³ç­–å»ºè®®

### å¼ºçƒˆæ¨èï¼šæ–¹æ¡ˆ Bï¼ˆç²¾ç®€æ–¹æ¡ˆï¼‰

**ç†ç”±ï¼š**

1. âœ… **ç¬¦åˆä½ çš„åˆ¤æ–­**ï¼šä¸å¢åŠ æ¨¡å—æ•°é‡
2. âœ… **éµå¾ª DRY åŸåˆ™**ï¼šä¸é‡å¤é€ è½®å­
3. âœ… **ç¬¦åˆ OmniAgent æ¶æ„**ï¼šå¤ç”¨ç°æœ‰ 7 ç»´
4. âœ… **å¼€å‘æ•ˆç‡é«˜**ï¼šèŠ‚çœ 82% æ—¶é—´
5. âœ… **ç»´æŠ¤æˆæœ¬ä½**ï¼šåªç»´æŠ¤ 1 ä¸ªé€‚é…å™¨
6. âœ… **ç”¨æˆ·ä½“éªŒå¥½**ï¼šé…ç½®ç®€å•ç»Ÿä¸€
7. âœ… **å®Œå…¨å¤Ÿç”¨**ï¼šæ”¯æŒæ‰€æœ‰éœ€è¦çš„å­˜å‚¨
8. âœ… **æ˜“äºæ‰©å±•**ï¼šæœªæ¥éœ€è¦æ—¶ä»å¯åˆ›å»ºä¸“é—¨ Starter

### å¦‚æœæœªæ¥çœŸçš„éœ€è¦

å¦‚æœæœªæ¥ç¡®å®å‘ç°é€‚é…å™¨æ–¹æ¡ˆæœ‰æ€§èƒ½é—®é¢˜æˆ–åŠŸèƒ½é™åˆ¶ï¼š

1. **ä¿ç•™é€‚é…å™¨**ï¼šä½œä¸ºé»˜è®¤å®ç°
2. **åˆ›å»ºä¸“é—¨ API**ï¼šå®šä¹‰æ ‡å‡†æ¥å£
3. **æŒ‰éœ€åˆ›å»º Starter**ï¼šåªåˆ›å»ºæœ€å¿…è¦çš„ï¼ˆå¦‚ MongoDBï¼‰
4. **å‘åå…¼å®¹**ï¼šé€‚é…å™¨ç»§ç»­å·¥ä½œ

**ä½†æ ¹æ®å½“å‰éœ€æ±‚ï¼Œç²¾ç®€æ–¹æ¡ˆå®Œå…¨å¤Ÿç”¨ï¼**

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. **[çŸ¥è¯†åŸŸå­˜å‚¨ç²¾ç®€æ–¹æ¡ˆ](KNOWLEDGE_DOMAIN_STORAGE_SIMPLIFIED.md)**
   - è¯¦ç»†çš„æŠ€æœ¯å®ç°
   - ä»£ç ç¤ºä¾‹
   - é…ç½®æŒ‡å—

2. **[çŸ¥è¯†ç½‘ç»œé‡æ„è®¡åˆ’](KNOWLEDGE_NETWORK_REFACTORING_PLAN.md)**
   - å·²æ›´æ–°ä¸ºç²¾ç®€æ–¹æ¡ˆ
   - å®Œæ•´çš„æ¶æ„è®¾è®¡

3. **[å¿«é€Ÿå¼€å§‹æŒ‡å—](../QUICK_START_REFACTORING.md)**
   - Phase 1 å®æ–½æ­¥éª¤
   - å·²ç§»é™¤ JPA ä¾èµ–
   - é‡‡ç”¨é€‚é…å™¨æ¨¡å¼

---

## ğŸ’¬ æ€»ç»“é™ˆè¯

ä½ çš„æ‹…å¿§å®Œå…¨åˆç†ï¼**æ¨¡å—è¿‡å¤šç¡®å®ä¼šå¸¦æ¥ç®¡ç†è´Ÿæ‹…ã€‚**

é€šè¿‡é‡‡ç”¨ç²¾ç®€æ–¹æ¡ˆï¼š
- âœ… **æ¨¡å—æ•°é‡ä¸å¢é•¿**ï¼šä¿æŒ 44 ä¸ª
- âœ… **å¼€å‘æ•ˆç‡æå‡**ï¼šèŠ‚çœ 82% æ—¶é—´
- âœ… **ç»´æŠ¤æˆæœ¬é™ä½**ï¼š83% å‡å°‘
- âœ… **æ¶æ„æ›´æ¸…æ™°**ï¼šå¤ç”¨ç°æœ‰ 7 ç»´

**è¿™æ˜¯ä¸€ä¸ªåŒèµ¢çš„å†³ç­–ï¼** ğŸ‰

---

**æ›´æ–°æ—¶é—´ï¼š** 2025-12-27  
**å†³ç­–ï¼š** é‡‡ç”¨æ–¹æ¡ˆ Bï¼ˆç²¾ç®€æ–¹æ¡ˆï¼‰  
**ä½œè€…ï¼š** OmniAgent æ¶æ„ä¼˜åŒ–ç»„

